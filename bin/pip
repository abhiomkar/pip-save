#!/bin/bash

source /usr/local/bin/virtualenvwrapper.sh
[ -z "$PIP" ] && export PIP=/usr/local/bin/pip

index=0
PIP_ARGS=( "$@" )

for i in "$@"
do
	if [[ $i == "install" || $i == "uninstall" ]]
	then
		echo "install/uninstall opt found"
		PIP_INSTALL_FLAG=1
	elif [[ $i == "init" ]]
	then
		mkvirtualenv $(basename $PWD) && touch .pip-init && workon test
		exit 0
	elif [[ $i == "--save" ]]
	then
		echo "save opt found"
		PIP_SAVE_FLAG=1
		unset PIP_ARGS[$index]
	fi

	let index++
done

if [[ $PIP_INSTALL_FLAG == 1 && $PIP_SAVE_FLAG == 1 ]]
then
	$PIP ${PIP_ARGS[@]} && $PIP freeze > requirements.txt
else
	$PIP $*
fi
